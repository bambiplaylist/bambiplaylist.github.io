let files = ["https://drive.google.com/u/0/uc?id=14muYz4d6JhmrkBjfhGDz77hARy_lvvo5&export=download","https://drive.google.com/u/0/uc?id=1fcMeTfd8MaSbmoTR6sztpdnY041yJtvn&export=download","https://drive.google.com/u/0/uc?id=1jqPT47S2TPwNDSApREdvshlCRh7izPkA&export=download","https://drive.google.com/u/0/uc?id=1ZFToGfHyavVHPg5ADmvtvAcWZG6lf66R&export=download","https://drive.google.com/u/0/uc?id=1EwWavNrQYZ5_a3CB5rnw3GE3zonql8cN&export=download","https://drive.google.com/u/0/uc?id=15i3gX0vuOYsh_G9BQumvtKNmEc1Leis6&export=download","https://drive.google.com/u/0/uc?id=1cKFU7cMhDDjcbxD6tSw8GexarmXfud2t&export=download","https://drive.google.com/u/0/uc?id=17jYpZb_PMS3QZCnOSuojBqYLabFHQ9zD&export=download","https://drive.google.com/u/0/uc?id=1hccFBggeIkm3vX6WGHJ9Nw0H0OXtHpP_&export=download","https://drive.google.com/u/0/uc?id=1xVfubZOV0fKaNGwbAzHamNr8Aex4Wv9l&export=download","https://drive.google.com/u/0/uc?id=1EsuwQJPSQBg6ftva1wUUUZqYAhmzfrIQ&export=download","https://drive.google.com/u/0/uc?id=1Y01jeDE_EkuCj0RudAAqQVPVTEV_7RPv&export=download","https://drive.google.com/u/0/uc?id=13IQA5vE-M-zrYOvEv0N3zQUNeajwS8Bc&export=download","https://drive.google.com/u/0/uc?id=1h7eAMALaumpftC8SkjTkWIO3kHr1wUNh&export=download","https://drive.google.com/u/0/uc?id=1y-vthxLM-kH_ecN4JLmOUhN4GYtKMBjF&export=download","https://drive.google.com/u/0/uc?id=15mPqE5_WKGRF5m9Kx9WO7TXWODItbCUc&export=download","https://download1648.mediafire.com/1zpy88mrhtug/5i0xoikhxntd8z5/01+Fake+Plastic+Fuckpuppet.mp3","https://download849.mediafire.com/sy9keb826k3g/sqajvk2igjo5im6/02+Designer+Pleasure+Puppet.mp3","https://download1653.mediafire.com/chyhvnx6atmg/1sa9xk0qbhrfkwe/03+Bimbo+Fuckpuppet+Oblivion.mp3","https://download1080.mediafire.com/vfyby5c0cy3g/qakm12363xmg6yx/01+Blowup+Pleasure+Toy.mp3","https://download942.mediafire.com/z02iuiti66yg/m3n8eow1g9dg261/02+Perfect+Bimbo+Maid.mp3","https://download1334.mediafire.com/hevu9fhiexcg/b4ucpzd63hfjs45/03+Restrained+and+Milked.mp3","https://download948.mediafire.com/45ix91vhoavg/lih3vc45g0jwjx0/01+Bimbo+Giggletime.mp3","https://download1496.mediafire.com/cblzoys0cigg/g8n5l6w6wosvizp/02+Mindlocked+Cock+Zombie.mp3","https://download1072.mediafire.com/mpkrmkk1hx6g/0zcm92b0c1psx5f/00+Bimbo+Drone.mp3","https://download1979.mediafire.com/t1kkgw5teiig/sfwiov3qj8qru20/01+Bimbo+Relaxation.mp3","https://www.mediafire.com/file/ocukxwxo6z2ornw/02_Bimbo_Mindwipe.mp3/file","https://download843.mediafire.com/6il7tgz6bhkg/4ik3lkld3u6oqzy/03+Bimbo+Slumber.mp3","https://download1581.mediafire.com/48voz7f7a5ng/73400acym5dwj21/04+Bimbo+Tranquility.mp3","https://download1321.mediafire.com/5k87cawuotdg/p7vdv725xargq70/05+Bimbo+Pride.mp3","https://download1591.mediafire.com/zq1ctqvuijsg/bsr9qi97188bqgi/06+Bimbo+Pleasure.mp3","https://download1514.mediafire.com/i1pas4pvw1bg/hivv4oiv0x1yc6q/07+Bimbo+Servitude.mp3","https://download936.mediafire.com/e2pkud5tk8pg/ul1torvgt8rn0fe/08+Bimbo+Addiction.mp3","https://download1335.mediafire.com/o10y9xuj0ldg/omftkkihfbdfvj7/09+Bimbo+Amnesia.mp3","https://download1588.mediafire.com/2u4iatczlgqg/ezhj8dfyhnvn4qh/10+Bimbo+Protection.mp3"];
let names = ["00 Rapid Induction", "01 Bubble Induction", "02 Bubble Acceptance", "03 Bambi Named and Drained", "04 Bambi IQ Lock", "05 Bambi Body Lock", "06 Bambi Attitude Lock", "07 Bambi Uniformed", "08 Bambi Takeover", "09 Bambi Cockslut", "10 Bambi Awakens", "01 Blank Mindless Doll", "02 Cock Dumb Hole", "03 Uniform Slut Puppet", "04 Vain Horny Happy", "05 Bimbo Drift", "01 Fake Plastic Fuckpuppet", "02 Designer Pleasure Puppet", "03 Bimbo Fuckpuppet Oblivion", "01 Blowup Pleasure Toy", "02 Perfect Bimbo Maid", "03 Restrained and Milked", "01 Bimbo Giggletime", "02 Mindlocked Cock Zombie", "00 Bimbo Drone", "01 Bimbo Relaxation", "02 Bimbo Mindwipe", "03 Bimbo Slumber", "04 Bimbo Tranquility", "05 Bimbo Pride", "06 Bimbo Pleasure", "07 Bimbo Servitude", "08 Bimbo Addiction", "09 Bimbo Amnesia", "10 Bimbo Protection"];
let list = document.getElementsByTagName("input");
let active = [""];

let orderer = document.getElementById("order"); 

function detectBrowser() {  
    if((navigator.userAgent.indexOf("Opera") || navigator.userAgent.indexOf('OPR')) != -1 ) {
        return 'Opera';
    } else if(navigator.userAgent.indexOf("Chrome") != -1 ) {  
        return 'Chrome'; 
    } else if(navigator.userAgent.indexOf("Safari") != -1) {
        return 'Safari';
    } else if(navigator.userAgent.indexOf("Firefox") != -1 ){
        return 'Firefox';
    } else if((navigator.userAgent.indexOf("MSIE") != -1 ) || (!!document.documentMode == true )) {
        return 'IE';//crap
    } else { 
        return 'Unknown';
    }
} 

function alertBox(msg) {
    zz = document.createElement("div");
    zz.className = "alert";
    zz.innerHTML = `<span class="closebtn">&times;</span>` + msg + ``;
    document.querySelector("#alertBoxs").appendChild(zz);

    zz.onclick = function () {
        div = zz;
        div.style.opacity = "0";
        setTimeout(function () {
            div.style.display = "none";
        }, 600);
    }
    setTimeout(function (that) {
        var div = that;
        div.style.opacity = "0";
        setTimeout(function () {
            div.style.display = "none";
        }, 600);
    }, 3000, zz);
}

window.onload = () => { 
  if(window.location.href.includes("?")){
    audioos = window.location.href.split("?list=")[1]
    audioos = audioos.split(",");
    for(i=0;i<audioos.length;i++){
      audios.push(new Audio(files[parseInt(audioos[i])]));
      
    } 
    audios.forEach(function(sound) {
      if(detectBrowser()=="Firefox"){
        sound.load();
      }
      sound.onended = onended;
    });
    indexes = [];
    for(j=0;j<audios.length;j++){
      indexes.push(files.indexOf(audios[j].src));
    }
    document.getElementById("permLink").innerText = window.location.href+"perma.html?list="+indexes.join(",");
    document.getElementById("permLink").href = window.location.href+"perma.html?list="+indexes.join(",");
  }
};

let inputHandle = (e) => {
  active = [];
  for(i=0;i<list.length;i++){ 
    if(list[i].checked){  
      active.push(files[i]); 
    }   
  }  
  renderItems(active)
    create();
} 
 
var list2 = document.getElementById('order') 
var nums = ["a"];
var dragging, draggedOver;

const genRandom = () => {
  active = active.sort(() => Math.random() - 0.5)
  renderItems(active)
}

const renderItems = (data) =>{
  list2.innerText = ''
  data.forEach(num=>{
    var node = document.createElement("li");    
    node.draggable = true
    node.addEventListener('drag', setDragging) 
    node.addEventListener('drop', compare) 
    node.addEventListener('dragover', allowDrop)
    var textnode = document.createElement(`a`);
    textnode.className = "ss";
    textnode.href = `${num}`;
    textnode.innerText = `${names[files.indexOf(num)]}`;
    node.appendChild(textnode);
    list2.appendChild(node)
  })
  dragging = null
  draggedOver = null
}

const compare = (e) =>{
  var index1 = active.indexOf(dragging);
  var index2 = active.indexOf(draggedOver);
  active.splice(index1, 1)
  active.splice(index2, 0, dragging)
  
  renderItems(active)
 
}; 

var decodeEntities = (function() {
  // this prevents any overhead from creating the object each time
  var element = document.createElement('div');

  function decodeHTMLEntities (str) {
    if(str && typeof str === 'string') {
      // strip script/html tags
      str = str.replace(/<script[^>]*>([\S\s]*?)<\/script>/gmi, '');
      str = str.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gmi, '');
      element.innerHTML = str;
      str = element.textContent;
      element.textContent = '';
    }

    return str;
  }

  return decodeHTMLEntities;
})();

function allowDrop(ev) {
    ev.preventDefault();
    draggedOver = decodeEntities(ev.target.innerHTML.split("href=\"")[1].split("\">")[0]);
    audios = [];
}

const setDragging = (e) =>{
  dragging =  decodeEntities(e.target.innerHTML.split("href=\"")[1].split("\">")[0]);
  audios = [];
}

var audios = [];
var currentIndex = 0;

let create = () => {
  audios = [];
  for(i=0;i<active.length;i++){
    audios.push(new Audio(active[i]));
  }
  audios.forEach(function(sound) {
    if(detectBrowser()=="Firefox"){
      sound.load();
    }
    sound.onended = onended;
  });
  indexes = [];
  for(j=0;j<audios.length;j++){
    indexes.push(files.indexOf(audios[j].src));
  }
  document.getElementById("permLink").innerText = window.location.href+"perma.html?list="+indexes.join(",");
  document.getElementById("permLink").href = window.location.href+"perma.html?list="+indexes.join(",");
  return false;
}
                    
function onended(evt) {
  currentIndex = (currentIndex + 1) % audios.length; // increment our index
  audios[currentIndex].play(); // play the next sound
}

document.getElementById("play").onclick = () => {
  audios[0].play();
};
                    
document.getElementById("stop").onclick = () => {
  for(i=0;i<audios.length;i++){
    audios[i].pause();
  }
};
